# 功能需求

本文档汇总当前软件已实现/已支持的功能点，用于确认需求范围。

## 1. 基础配置与启动行为
- 默认接收路径：优先使用 D:/rustle_downloads，若无 D 盘则使用 C:/rustle_downloads。
- 自动创建数据目录与历史目录（本地用户数据、聊天记录、同步树等）。
- 启动时读取本地用户名（me.txt），若为空则弹窗提示输入。
- 启动时加载已知联系人列表、最近聊天记录与同步树。

## 1.1 软件设置窗口
- 提供“设置”窗口入口。
- 用户可设置项：
	- 历史记录保存天数（默认 180 天）。
	- 接收文件夹路径（默认 D:/rustle_downloads）。
	- 发送文件和文件夹时自动同步（默认 同意）。
	- 启动时更新检查（默认 开启）。
	- 本机显示名称（等同于 me.txt，可在设置中修改）。
	- 首选/固定发送网卡（默认 自动选择最佳网卡）。

## 2. 节点发现与在线状态
- 基于 UDP 广播的局域网节点发现（支持多网卡与子网广播）。
- 节点上线/下线状态维护与刷新（带心跳/超时判定）。
- 启动后对已知节点做定向探测以提升上线成功率。
- 支持维护在线/离线列表视图。

## 3. 联系人管理
- 自动创建/更新联系人条目（含 ID、名称、IP）。
- 联系人在线/离线显示与未读标记。
- 联系人右键菜单：查看用户信息、删除联系人。
- 删除联系人时清理历史与缓存数据。

## 4. 文本聊天
- 点对点文本聊天。
- 显示发送/接收时间戳。
- 未读消息提示与选中后清除未读。
- 支持昵称更新（对端名称更新后刷新本地显示）。

## 5. 可靠消息与离线消息
- 消息 ACK 确认机制。
- 发送失败或对方离线时进入离线队列。
- 对方上线后自动重发离线消息。
- 发送重试与待确认状态显示。

## 6. 文件与文件夹传输
- 支持发送单文件与文件夹。
- 文件夹发送时自动打包（tar）后传输；接收端自动解包。
- 拖拽文件/文件夹到窗口即可发送。
- 手动选择文件/文件夹发送。
- 传输进度、速度与状态提示（发送中/接收中/完成/失败）。
- 支持断点续收路径映射（接收路径记忆）。

## 7. 自动同步
- 维护同步树结构（目录与文件元信息：mtime、sha256）。
- 支持自动同步扫描与变更检测。
- 变更后自动发起同步传输（文件或文件夹）。
- 同步传输与普通传输区分显示与记录。

## 8. 历史记录
- 聊天记录持久化（JSONL）。
- 启动时加载近 180 天历史记录。
- 文件传输完成记录到历史。
- ACK/同步状态写入历史。

## 9. 多网卡与接口选择
- 启动时选择最佳本地 IPv4（基于流量选择优先接口）。
- 发送消息/文件时尽量选择同网段或指定接口。
- 记录并使用最佳接口与绑定接口。

## 10. UI 与交互体验
- 在线/离线分区列表展示。
- 当前选中联系人聊天窗口。
- 弹窗提示（用户名输入、IP 信息、更新提示）。
- 固定刷新节奏保证消息与进度显示实时性。

## 11. 版本更新
- 启动后可触发更新检查（GitHub Releases）。

---

请确认以上功能点是否完整。如需补充/删减，我会在确认后继续输出：
1) doc/技术实现方式.md（逐功能实现细节）
2) doc/测试方法.md（逐功能测试方法）
